geom_text(
data = mutate_if(summary_forest, is.numeric, round, 2),
aes(
label = glue("{b_Intercept} [{.lower}, {.upper}]"),
x = Inf
),
hjust = "inward"
) +
labs(x = "Relative Risk",
y = element_blank(),
title = title,
caption = type) +
theme_minimal()
graph <- ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf), fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(m1)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
fill = fill,
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
) +
geom_pointinterval(data = summary_forest, size = 1) +
geom_text(
data = mutate_if(summary_forest, is.numeric, round, 2),
aes(
label = glue("{b_Intercept} [{.lower}, {.upper}]"),
x = Inf
),
hjust = "inward"
) +
labs(x = "Relative Risk",
y = element_blank(),
title = "Forest plot of current smokers and risk of testing positive",
caption = "Minimally informative prior") +
theme_minimal()
graph
ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf), fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(m1)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
fill = fill,
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
) +
geom_pointinterval(data = summary_forest, size = 1) +
geom_text(
data = mutate_if(summary_forest, is.numeric, round, 2),
aes(
label = glue("{b_Intercept} [{.lower}, {.upper}]"),
x = Inf
),
hjust = "inward"
) +
labs(x = "Relative Risk",
y = element_blank(),
title = "Forest plot of current smokers and risk of testing positive",
caption = "Minimally informative prior") +
theme_minimal()
forest_data
ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf), fill = review_version),
data = forest_data)
ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf), fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1)
ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf), fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(m1)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
fill = review_version,
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
)
ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf), fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(m1)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
aes(fill = review_version),
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
)
?relevel
ggplot(aes(b_Intercept, relevel(Author, "review_version", after = Inf) %>%
relevel(Author, "Pooled Effect", after = Inf),
fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(m1)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
aes(fill = review_version),
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
) +
geom_pointinterval(data = summary_forest, size = 1) +
geom_text(
data = mutate_if(summary_forest, is.numeric, round, 2),
aes(
label = glue("{b_Intercept} [{.lower}, {.upper}]"),
x = Inf
),
hjust = "inward"
) +
labs(x = "Relative Risk",
y = element_blank(),
title = "Forest plot of current smokers and risk of testing positive",
caption = "Minimally informative prior") +
theme_minimal()
forest_data
forest_data
?reorder
forest_data <- bind_rows(study_draws_m1, pooled_draw_m1) %>%
ungroup() %>%
mutate(Author = str_replace_all(Author, "[.]", " ")) %>%
mutate(Author = reorder(Author, review_version))
summary_forest <- group_by(forest_data, Author) %>%
mean_qi(b_Intercept)
forest_data
ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf),
fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(m1)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
aes(fill = review_version),
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
) +
geom_pointinterval(data = summary_forest, size = 1) +
geom_text(
data = mutate_if(summary_forest, is.numeric, round, 2),
aes(
label = glue("{b_Intercept} [{.lower}, {.upper}]"),
x = Inf
),
hjust = "inward"
) +
labs(x = "Relative Risk",
y = element_blank(),
title = "Forest plot of current smokers and risk of testing positive",
caption = "Minimally informative prior") +
theme_minimal()
ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf),
fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(m1)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
aes(fill = review_version),
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
)
unique(study_review_version$Author)
View(study_draws_m1)
unique(study_draws_m1$Author)
study_review_version <- data_study_general %>%
mutate(lead_author = to_upper_camel_case(lead_author, sep_out = ", "),
lead_author = plyr::mapvalues(lead_author,
from = cleaned_names,
to = correct_names),
lead_author = recode("de Lusignan" = "de.Lusignan")) %>%
select(lead_author, review_version) %>%
rename(Author = lead_author) %>%
mutate(review_version = factor(fct_collapse(review_version, previous = previous_review_versions, current = current_review_version)))
study_review_version <- data_study_general %>%
mutate(lead_author = to_upper_camel_case(lead_author, sep_out = ", "),
lead_author = plyr::mapvalues(lead_author,
from = cleaned_names,
to = correct_names),
lead_author = recode(lead_author, "de Lusignan" = "de.Lusignan")) %>%
select(lead_author, review_version) %>%
rename(Author = lead_author) %>%
mutate(review_version = factor(fct_collapse(review_version, previous = previous_review_versions, current = current_review_version)))
study_draws_m1 <- study_draw(m1)
pooled_draw_m1 <- pooled_effect_draw(m1)
forest_data <- bind_rows(study_draws_m1, pooled_draw_m1) %>%
ungroup() %>%
mutate(Author = str_replace_all(Author, "[.]", " ")) %>%
mutate(Author = reorder(Author, review_version))
summary_forest <- group_by(forest_data, Author) %>%
mean_qi(b_Intercept)
graph <- ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf),
fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(m1)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
aes(fill = review_version),
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
)
forest_data
View(forest_data)
ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf),
fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(m1)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
aes(fill = review_version),
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
)
ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf),
fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(m1)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
aes(fill = review_version),
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
) +
geom_pointinterval(data = summary_forest, size = 1) +
geom_text(
data = mutate_if(summary_forest, is.numeric, round, 2),
aes(
label = glue("{b_Intercept} [{.lower}, {.upper}]"),
x = Inf
),
hjust = "inward"
) +
labs(x = "Relative Risk",
y = element_blank(),
title = "Forest plot of current smokers and risk of testing positive",
caption = "Minimally informative prior") +
theme_minimal()
ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf),
fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(m1)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
aes(fill = review_version),
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
)
ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf),
fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(m1)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
aes(fill = review_version),
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
) +
geom_pointinterval(data = summary_forest, size = 1)
summary_forest
summary_forest
forest_data
forest_data <- bind_rows(study_draws_m1, pooled_draw_m1) %>%
ungroup() %>%
mutate(Author = str_replace_all(Author, "[.]", " ")) %>%
mutate(Author = reorder(Author, review_version))
summary_forest <- group_by(forest_data, Author) %>%
mean_qi(b_Intercept)
summary_forest
summary_forest <- group_by(forest_data, Author, review_version) %>%
mean_qi(b_Intercept)
summary_forest
ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf),
fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(m1)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
aes(fill = review_version),
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
) +
geom_pointinterval(data = summary_forest, size = 1) +
geom_text(
data = mutate_if(summary_forest, is.numeric, round, 2),
aes(
label = glue("{b_Intercept} [{.lower}, {.upper}]"),
x = Inf
),
hjust = "inward"
) +
labs(x = "Relative Risk",
y = element_blank(),
title = "Forest plot of current smokers and risk of testing positive",
caption = "Minimally informative prior") +
theme_minimal()
forest_data
forest_data <- bind_rows(study_draws_m1, pooled_draw_m1) %>%
ungroup() %>%
mutate(Author = str_replace_all(Author, "[.]", " ")) %>%
mutate(Author = reorder(Author, b_Intercept))
summary_forest <- group_by(forest_data, Author, review_version) %>%
mean_qi(b_Intercept)
graph <- ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf),
fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(m1)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(m1)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
aes(fill = review_version),
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
) +
geom_pointinterval(data = summary_forest, size = 1) +
geom_text(
data = mutate_if(summary_forest, is.numeric, round, 2),
aes(
label = glue("{b_Intercept} [{.lower}, {.upper}]"),
x = Inf
),
hjust = "inward"
) +
labs(x = "Relative Risk",
y = element_blank(),
title = "Forest plot of current smokers and risk of testing positive",
caption = "Minimally informative prior") +
theme_minimal()
graph
forest_data
forest_data <- bind_rows(study_draws_m1, pooled_draw_m1) %>%
ungroup() %>%
mutate(Author = str_replace_all(Author, "[.]", " ")) %>%
mutate(Author = reorder(Author, c(review_version, b_Intercept)))
current_testing_minimal_prior <- forest_plot(
m1,
study_draws_m1,
pooled_draw_m1,
"Forest plot of current smokers and risk of testing positive",
"Minimally informative prior",
"m1.png"
)
forest_plot <- function(model, data_study, data_pooled, title, type, filename) {
forest_data <- bind_rows(data_study, data_pooled) %>%
ungroup() %>%
mutate(Author = str_replace_all(Author, "[.]", " ")) %>%
mutate(Author = reorder(Author, b_Intercept))
summary_forest <- group_by(forest_data, Author, review_version) %>%
mean_qi(b_Intercept)
graph <- ggplot(aes(b_Intercept, relevel(Author, "Pooled Effect", after = Inf), fill = review_version),
data = forest_data) +
geom_vline(xintercept = fixef(model)[1, 1],
color = "grey",
size = 1) +
geom_vline(xintercept = fixef(model)[1, 3:4],
color = "grey",
linetype = 2) +
geom_vline(xintercept = 0,
color = "black",
size = 1) +
geom_density_ridges(
aes(fill = review_version),
rel_min_height = 0.01,
col = NA,
scale = 1,
alpha = 0.8
) +
geom_pointinterval(data = summary_forest, size = 1) +
geom_text(
data = mutate_if(summary_forest, is.numeric, round, 2),
aes(
label = glue("{b_Intercept} [{.lower}, {.upper}]"),
x = Inf
),
hjust = "inward"
) +
labs(x = "Relative Risk",
y = element_blank(),
title = title,
caption = type) +
theme_minimal()
outputs <- list("plot" = graph, "data" = forest_data, "summary" = summary_forest)
ggsave(filename = filename, plot = graph, device = "png", path = here("reports", "figure"))
return(outputs)
}
current_testing_minimal_prior <- forest_plot(
m1,
study_draws_m1,
pooled_draw_m1,
"Forest plot of current smokers and risk of testing positive",
"Minimally informative prior",
"m1.png"
)
current_testing_minimal_prior
