a <- flextable(a) %>%
set_caption(caption = 'COVID-19 severity by smoking status') %>%
colformat_num(col_keys = numeric_columns, digits = 0, na_str = '-', big.mark = ',') %>%
colformat_char(na_str = '-')
a <- set_header_labels(a,
Population = "Population with severity",
non_severe_disease = "N (%)",
ns_current_smoker = "Current smoker (%)",
ns_former_smoker = "Former smoker (%)",
ns_current_former_smoker = "Current/former smoker (%)",
ns_never_unknown_smoker = "Never/unknown smoker (%)",
ns_never_smoker = "Never smoker (%)",
ns_not_stated = "Not stated (%)",
severe_disease = "N (%)",
s_current_smoker = "Current smoker (%)",
s_former_smoker = "Former smoker (%)",
s_current_former_smoker = "Current/former smoker (%)",
s_never_unknown_smoker = "Never/unknown smoker (%)",
s_never_smoker = "Never smoker (%)",
s_not_stated = "Not stated (%)") %>%
add_header_row(top = TRUE, values = c("","Non severe disease", "Severe disease" ), colwidths = c(2, 7, 7)) %>%
theme_booktabs() %>%
fix_border_issues() %>%
set_table_properties(width = 1, layout = 'autofit')
a
save_as_docx(a, path = here('data_clean', 'Table_4.docx'))
included_studies <- quality_table_4 %>%
filter(overall_quality == 'fair') %>%
select(lead_author)
table_4 <- table_4_word
# Data --------------------------------------------------------------------
meta <- tibble('author' = table_4$lead_author,
'non_severe_smoker' = table_4$non_severe_current_smoker,
'non_severe_never_smoker' = table_4$non_severe_never_smoker,
'severe_smoker' = table_4$severe_disease_current_smoker,
'severe_never_smoker' = table_4$severe_disease_never_smoker,
'non_severe_former_smoker' = table_4$non_severe_former_smoker,
'severe_former_smoker' = table_4$severe_disease_former_smoker) %>%
filter(author %in% included_studies$lead_author)
meta$author <- to_upper_camel_case(meta$author, sep_out = ", ")
meta$author <- plyr::mapvalues(meta$author,
from = cleaned_names,
to = correct_names)
# Current smoker severity ------------------------------------------
event_rates_smoker <- meta %>%
mutate(., Ee = severe_smoker) %>%
mutate(., Ne = (severe_smoker+non_severe_smoker)) %>%
mutate(., Ec = severe_never_smoker) %>%
mutate(., Nc = (severe_never_smoker+non_severe_never_smoker)) %>%
rename('Author' = author) %>%
select(Author, Ee, Ne, Ec, Nc)
event_rates_smoker <- metabin(Ee,
Ne,
Ec,
Nc,
data = event_rates_smoker,
studlab = paste(Author),
comb.fixed = T,
comb.random = F,
method.tau = 'SJ',
hakn = F,
prediction = F,
incr = 0.1,
sm = 'RR')
png(here::here('reports', 'figure', 'fig_7.png'), width=1024, height=546, res=120)
current_smoker_severity <- forest(event_rates_smoker,
sortvar = Author,
xlim = c(0.1, 5),
rightlabs = c('RR', '95% CI', 'Weight'),
leftlabs = c('Author', 'logRR', 'SE'),
lab.e = 'Current smoker',
lab.c = 'Never smoker',
print.tau2 = F,
col.diamond = 'blue',
col.diamond.lines = 'black',
col.square = 'black',
col.square.lines = 'black',
digits.sd = 2)
null <- dev.off()
event_rates_smoker
forest(event_rates_smoker,
sortvar = Author,
xlim = c(0.1, 5),
rightlabs = c('RR', '95% CI', 'Weight'),
leftlabs = c('Author', 'logRR', 'SE'),
lab.e = 'Current smoker',
lab.c = 'Never smoker',
print.tau2 = F,
col.diamond = 'blue',
col.diamond.lines = 'black',
col.square = 'black',
col.square.lines = 'black',
digits.sd = 2)
# Former smoker hospitalisation -------------------------------------------
event_rates_former <- meta %>%
mutate(., Ee = severe_former_smoker) %>%
mutate(., Ne = (severe_former_smoker+non_severe_former_smoker)) %>%
mutate(., Ec = severe_never_smoker) %>%
mutate(., Nc = (severe_never_smoker+non_severe_never_smoker)) %>%
rename('Author' = author) %>%
select(Author, Ee, Ne, Ec, Nc)
event_rates_former <- metabin(Ee,
Ne,
Ec,
Nc,
data = event_rates_former,
studlab = paste(Author),
comb.fixed = F,
comb.random = T,
method.tau = 'SJ',
hakn = F,
prediction = F,
incr = 0.1,
sm = 'RR')
png(here::here('reports', 'figure', 'fig_8.png'), width=1024, height=546, res=120)
former_smoker_severity <- forest(event_rates_former,
sortvar = Author,
xlim = c(0.2, 10),
rightlabs = c('RR', '95% CI', 'Weight'),
leftlabs = c('Author', 'logRR', 'SE'),
lab.e = 'Former smoker',
lab.c = 'Never smoker',
print.tau2 = F,
col.diamond = 'blue',
col.diamond.lines = 'black',
col.square = 'black',
col.square.lines = 'black',
digits.sd = 2)
null <- dev.off()
event_rates_former
#Table 5
table_5_word <- table_5 %>%
mutate(., sample = sample_with_deaths) %>%
mutate(., deaths_percentage = formatC(deaths/sample*100, digits = 2, format = "f")) %>%
mutate(., death_current_smokers_percent = formatC(death_current_smokers/deaths*100, digits = 2, format = "f")) %>%
mutate(., death_former_smokers_percent = formatC(death_former_smokers/deaths*100, digits = 2, format = "f")) %>%
mutate(., death_current_former_smokers_percent = formatC(death_current_former_smokers/deaths*100, digits = 2, format = "f")) %>%
mutate(., death_never_smokers_percent = formatC(death_never_smokers/deaths*100, digits = 2, format = "f")) %>%
mutate(., death_never_unknown_smokers_percent = formatC(death_never_unknown_smokers/deaths*100, digits = 2, format = "f")) %>%
mutate(., death_not_stated_percent = formatC(death_not_stated/deaths*100, digits = 2, format = "f")) %>%
mutate(., recovered_percentage = formatC(recovered/sample*100, digits = 2, format = "f")) %>%
mutate(., recovered_current_smokers_percent = formatC(recovered_current_smoking/recovered*100, digits = 2, format = "f")) %>%
mutate(., recovered_former_smokers_percent = formatC(recovered_former_smoker/recovered*100, digits = 2, format = "f")) %>%
mutate(., recovered_current_former_smokers_percent = formatC(recovered_current_former_smokers/recovered*100, digits = 2, format = "f")) %>%
mutate(., recovered_never_smokers_percent = formatC(recovered_never_smoker/recovered*100, digits = 2, format = "f")) %>%
mutate(., recovered_never_unknown_smokers_percent = formatC(recovered_never_unknown_smoker/recovered*100, digits = 2, format = "f")) %>%
mutate(., recovered_not_stated_percent = formatC(recovered_not_stated/recovered*100, digits = 2, format = "f")) %>%
select(lead_author, sample, recovered, recovered_percentage, recovered_current_smoking, recovered_current_smokers_percent,
recovered_former_smoker, recovered_former_smokers_percent, recovered_current_former_smokers,
recovered_current_former_smokers_percent, recovered_never_smoker, recovered_never_smokers_percent,
recovered_never_unknown_smoker, recovered_never_unknown_smokers_percent, recovered_not_stated,
recovered_not_stated_percent,
deaths, deaths_percentage, death_current_smokers, death_current_smokers_percent,
death_former_smokers, death_former_smokers_percent, death_current_former_smokers,
death_current_former_smokers_percent, death_never_smokers, death_never_smokers_percent,
death_never_unknown_smokers, death_never_unknown_smokers_percent, death_not_stated, death_not_stated_percent) %>%
write_rds(here::here('data_clean', 'table_5_word.rds'))
quality_table_5 <- table_5_word %>%
left_join(., quality_rating, by = 'lead_author') %>%
select(lead_author, overall_quality)
a <- table_5_word %>%
filter(recovered >= 1) %>%
mutate(Author = lead_author,
Population = sample,
recovered = paste(
paste(recovered,
as.integer(recovered_percentage), sep = " ("), "%)", sep = ""),
recovered_current_smoker = paste(paste(recovered_current_smoking,
(recovered_current_smokers_percent), sep = " (")
, "%)", sep = ""),
recovered_current_smoker = na_if(recovered_current_smoker, "NA ( NA%)"),
recovered_former_smoker = paste(paste(recovered_former_smoker,
(recovered_former_smokers_percent), sep = " (")
, "%)", sep = ""),
recovered_former_smoker = na_if(recovered_former_smoker, "NA ( NA%)"),
recovered_current_former_smoker = paste(paste(recovered_current_former_smokers,
(recovered_current_former_smokers_percent), sep = " (")
, "%)", sep = ""),
recovered_current_former_smoker = na_if(recovered_current_former_smoker, "NA ( NA%)"),
recovered_never_smoker = paste(paste(recovered_never_smoker,
(recovered_never_smokers_percent), sep = " (")
, "%)", sep = ""),
recovered_never_smoker = na_if(recovered_never_smoker, "NA ( NA%)"),
recovered_never_unknown_smoker = paste(paste(recovered_never_unknown_smoker,
(recovered_never_unknown_smokers_percent), sep = " (")
, "%)", sep = ""),
recovered_never_unknown_smoker = na_if(recovered_never_unknown_smoker, "NA ( NA%)"),
recovered_not_stated = paste(paste(recovered_not_stated,
(recovered_not_stated_percent), sep = " (")
, "%)", sep = ""),
recovered_not_stated = na_if(recovered_not_stated, "NA ( NA%)")) %>%
mutate(deaths = paste(
paste(deaths,
as.integer(deaths_percentage), sep = " ("), "%)", sep = ""),
death_current_smoker = paste(paste(death_current_smokers,
(death_current_smokers_percent), sep = " (")
, "%)", sep = ""),
death_current_smoker = na_if(death_current_smoker, "NA ( NA%)"),
death_former_smoker = paste(paste(death_former_smokers,
(death_former_smokers_percent), sep = " (")
, "%)", sep = ""),
death_former_smoker = na_if(death_former_smoker, "NA ( NA%)"),
death_current_former_smoker = paste(paste(death_current_former_smokers,
(death_current_former_smokers_percent), sep = " (")
, "%)", sep = ""),
death_current_former_smoker = na_if(death_current_former_smoker, "NA ( NA%)"),
death_never_smoker = paste(paste(death_never_smokers,
(death_never_smokers_percent), sep = " (")
, "%)", sep = ""),
death_never_smoker = na_if(death_never_smoker, "NA ( NA%)"),
death_never_unknown_smoker = paste(paste(death_never_unknown_smokers,
(death_never_unknown_smokers_percent), sep = " (")
, "%)", sep = ""),
death_never_unknown_smoker = na_if(death_never_unknown_smoker, "NA ( NA%)"),
death_not_stated = paste(paste(death_not_stated,
(death_not_stated_percent), sep = " (")
, "%)", sep = ""),
death_not_stated = na_if(death_not_stated, "NA ( NA%)")) %>%
select(Author, Population, recovered, recovered_current_smoker, recovered_former_smoker, recovered_current_former_smoker,
recovered_never_smoker, recovered_never_unknown_smoker, recovered_not_stated, deaths, death_current_smoker,
death_former_smoker, death_current_former_smoker, death_never_smoker, death_never_unknown_smoker,
death_not_stated)
a$Author <- to_upper_camel_case(a$Author, sep_out = ", ")
a$Author  <- a$Author  %>%
recode("Carrillo, Vega"  = "Carillo-Vega",
"Heili, Frades" = "Heili-Frades",
"Al, Hindawi" = "Al-Hindawi",
"Soto, Mota" = "Soto-Mota")
numeric_columns <- 'Population'
a <- flextable(a) %>%
set_caption(caption = 'COVID-19 mortality by smoking status') %>%
colformat_num(col_keys = numeric_columns, digits = 0, na_str = '-', big.mark = ',') %>%
colformat_char(na_str = '-')
a <- set_header_labels(a,
Population = "Population with mortality",
recovered = "N (%)",
recovered_current_smoker = "Current smoker (%)",
recovered_former_smoker = "Former smoker (%)",
recovered_current_former_smoker = "Current/former smoker (%)",
recovered_never_unknown_smoker = "Never/unknown smoker (%)",
recovered_never_smoker = "Never smoker (%)",
recovered_not_stated = "Not stated (%)",
deaths = "N (%)",
death_current_smoker = "Current smoker (%)",
death_former_smoker = "Former smoker (%)",
death_current_former_smoker = "Current/former smoker (%)",
death_never_unknown_smoker = "Never/unknown smoker (%)",
death_never_smoker = "Never smoker (%)",
death_not_stated = "Not stated (%)") %>%
add_header_row(top = TRUE, values = c("","Recovered", "Died" ), colwidths = c(2, 7, 7)) %>%
theme_booktabs() %>%
fix_border_issues() %>%
set_table_properties(width = 1, layout = 'autofit')
a
save_as_docx(a, path = here('data_clean', 'Table_5.docx'))
a$Author <- plyr::mapvalues(a$Author,
from = cleaned_names,
to = correct_names)
numeric_columns <- 'Population'
a <- flextable(a) %>%
set_caption(caption = 'COVID-19 mortality by smoking status') %>%
colformat_num(col_keys = numeric_columns, digits = 0, na_str = '-', big.mark = ',') %>%
colformat_char(na_str = '-')
a <- set_header_labels(a,
Population = "Population with mortality",
recovered = "N (%)",
recovered_current_smoker = "Current smoker (%)",
recovered_former_smoker = "Former smoker (%)",
recovered_current_former_smoker = "Current/former smoker (%)",
recovered_never_unknown_smoker = "Never/unknown smoker (%)",
recovered_never_smoker = "Never smoker (%)",
recovered_not_stated = "Not stated (%)",
deaths = "N (%)",
death_current_smoker = "Current smoker (%)",
death_former_smoker = "Former smoker (%)",
death_current_former_smoker = "Current/former smoker (%)",
death_never_unknown_smoker = "Never/unknown smoker (%)",
death_never_smoker = "Never smoker (%)",
death_not_stated = "Not stated (%)") %>%
add_header_row(top = TRUE, values = c("","Recovered", "Died" ), colwidths = c(2, 7, 7)) %>%
theme_booktabs() %>%
fix_border_issues() %>%
set_table_properties(width = 1, layout = 'autofit')
a
save_as_docx(a, path = here('data_clean', 'Table_5.docx'))
# Data --------------------------------------------------------------------
meta <- tibble('author' = table_5$lead_author,
'recovered_current_smoker' = table_5$recovered_current_smoking,
'recovered_never_smoker' = table_5$recovered_never_smoker,
'death_current_smoker' = table_5$death_current_smokers,
'death_never_smoker' = table_5$death_never_smokers,
'recovered_former_smoker' = table_5$recovered_former_smoker,
'death_former_smoker' = table_5$death_former_smokers) %>%
filter(author %in% included_studies$lead_author)
meta$author <- to_upper_camel_case(meta$author, sep_out = ", ")
meta$author <- plyr::mapvalues(meta$author,
from = cleaned_names,
to = correct_names)
# Current smoker mortality ------------------------------------------
event_rates_smoker <- meta %>%
mutate(., Ee = death_current_smoker) %>%
mutate(., Ne = (death_current_smoker+recovered_current_smoker)) %>%
mutate(., Ec = death_never_smoker) %>%
mutate(., Nc = (death_never_smoker+recovered_never_smoker)) %>%
rename('Author' = author) %>%
select(Author, Ee, Ne, Ec, Nc)
event_rates_smoker <- metabin(Ee,
Ne,
Ec,
Nc,
data = event_rates_smoker,
studlab = paste(Author),
comb.fixed = T,
comb.random = F,
method.tau = 'SJ',
hakn = F,
prediction = F,
incr = 0.1,
sm = 'RR')
png(here::here('reports', 'figure', 'fig_9.png'), width=1024, height=546, res=120)
current_smoker_mortality <- forest(event_rates_smoker,
sortvar = Author,
xlim = c(0.1, 5),
rightlabs = c('RR', '95% CI', 'Weight'),
leftlabs = c('Author', 'logRR', 'SE'),
lab.e = 'Current smoker',
lab.c = 'Never smoker',
print.tau2 = F,
col.diamond = 'blue',
col.diamond.lines = 'black',
col.square = 'black',
col.square.lines = 'black',
digits.sd = 2)
null <- dev.off()
event_rates_smoker
meta
table_5
# Data --------------------------------------------------------------------
meta <- tibble('author' = table_5$lead_author,
'recovered_current_smoker' = table_5$recovered_current_smoking,
'recovered_never_smoker' = table_5$recovered_never_smoker,
'death_current_smoker' = table_5$death_current_smokers,
'death_never_smoker' = table_5$death_never_smokers,
'recovered_former_smoker' = table_5$recovered_former_smoker,
'death_former_smoker' = table_5$death_former_smokers) %>%
filter(author %in% included_studies$lead_author)
meta$author <- to_upper_camel_case(meta$author, sep_out = ", ")
meta$author <- plyr::mapvalues(meta$author,
from = cleaned_names,
to = correct_names)
# Current smoker mortality ------------------------------------------
event_rates_smoker <- meta %>%
mutate(., Ee = death_current_smoker) %>%
mutate(., Ne = (death_current_smoker+recovered_current_smoker)) %>%
mutate(., Ec = death_never_smoker) %>%
mutate(., Nc = (death_never_smoker+recovered_never_smoker)) %>%
rename('Author' = author) %>%
select(Author, Ee, Ne, Ec, Nc)
event_rates_smoker <- metabin(Ee,
Ne,
Ec,
Nc,
data = event_rates_smoker,
studlab = paste(Author),
comb.fixed = T,
comb.random = F,
method.tau = 'SJ',
hakn = F,
prediction = F,
incr = 0.1,
sm = 'RR')
png(here::here('reports', 'figure', 'fig_9.png'), width=1024, height=546, res=120)
current_smoker_mortality <- forest(event_rates_smoker,
sortvar = Author,
xlim = c(0.1, 5),
rightlabs = c('RR', '95% CI', 'Weight'),
leftlabs = c('Author', 'logRR', 'SE'),
lab.e = 'Current smoker',
lab.c = 'Never smoker',
print.tau2 = F,
col.diamond = 'blue',
col.diamond.lines = 'black',
col.square = 'black',
col.square.lines = 'black',
digits.sd = 2)
null <- dev.off()
event_rates_smoker
View(quality_rating)
included_studies$lead_author
quality_table_5
included_studies <- quality_table_5 %>%
filter(overall_quality == 'fair') %>%
select(lead_author)
included_studies
tibble('author' = table_5$lead_author,
'recovered_current_smoker' = table_5$recovered_current_smoking,
'recovered_never_smoker' = table_5$recovered_never_smoker,
'death_current_smoker' = table_5$death_current_smokers,
'death_never_smoker' = table_5$death_never_smokers,
'recovered_former_smoker' = table_5$recovered_former_smoker,
'death_former_smoker' = table_5$death_former_smokers) %>%
filter(author %in% included_studies$lead_author)
meta$author <- to_upper_camel_case(meta$author, sep_out = ", ")
meta$author <- plyr::mapvalues(meta$author,
from = cleaned_names,
to = correct_names)
meta$author
meta$author
# Data --------------------------------------------------------------------
meta <- tibble('author' = table_5$lead_author,
'recovered_current_smoker' = table_5$recovered_current_smoking,
'recovered_never_smoker' = table_5$recovered_never_smoker,
'death_current_smoker' = table_5$death_current_smokers,
'death_never_smoker' = table_5$death_never_smokers,
'recovered_former_smoker' = table_5$recovered_former_smoker,
'death_former_smoker' = table_5$death_former_smokers) %>%
filter(author %in% included_studies$lead_author)
meta$author
meta$author <- to_upper_camel_case(meta$author, sep_out = ", ")
meta$author
cleaned_names
correct_names
plyr::mapvalues(meta$author,
from = cleaned_names,
to = correct_names)
meta$author <- plyr::mapvalues(meta$author,
from = cleaned_names,
to = correct_names)
meta$author
# Current smoker mortality ------------------------------------------
event_rates_smoker <- meta %>%
mutate(., Ee = death_current_smoker) %>%
mutate(., Ne = (death_current_smoker+recovered_current_smoker)) %>%
mutate(., Ec = death_never_smoker) %>%
mutate(., Nc = (death_never_smoker+recovered_never_smoker)) %>%
rename('Author' = author) %>%
select(Author, Ee, Ne, Ec, Nc)
event_rates_smoker <- metabin(Ee,
Ne,
Ec,
Nc,
data = event_rates_smoker,
studlab = paste(Author),
comb.fixed = T,
comb.random = F,
method.tau = 'SJ',
hakn = F,
prediction = F,
incr = 0.1,
sm = 'RR')
png(here::here('reports', 'figure', 'fig_9.png'), width=1024, height=546, res=120)
current_smoker_mortality <- forest(event_rates_smoker,
sortvar = Author,
xlim = c(0.1, 5),
rightlabs = c('RR', '95% CI', 'Weight'),
leftlabs = c('Author', 'logRR', 'SE'),
lab.e = 'Current smoker',
lab.c = 'Never smoker',
print.tau2 = F,
col.diamond = 'blue',
col.diamond.lines = 'black',
col.square = 'black',
col.square.lines = 'black',
digits.sd = 2)
null <- dev.off()
event_rates_smoker
# Former smoker mortality ------------------------------------------
event_rates_former <- meta %>%
mutate(., Ee = death_former_smoker) %>%
mutate(., Ne = (death_former_smoker+recovered_former_smoker)) %>%
mutate(., Ec = death_never_smoker) %>%
mutate(., Nc = (death_never_smoker+recovered_never_smoker)) %>%
rename('Author' = author) %>%
select(Author, Ee, Ne, Ec, Nc)
event_rates_former <- metabin(Ee,
Ne,
Ec,
Nc,
data = event_rates_former,
studlab = paste(Author),
comb.fixed = T,
comb.random = F,
method.tau = 'SJ',
hakn = F,
prediction = F,
incr = 0.1,
sm = 'RR')
png(here::here('reports', 'figure', 'fig_10.png'), width=1024, height=546, res=120)
former_smoker_mortality <- forest(event_rates_former,
sortvar = Author,
xlim = c(0.1, 5),
rightlabs = c('RR', '95% CI', 'Weight'),
leftlabs = c('Author', 'logRR', 'SE'),
lab.e = 'Former smoker',
lab.c = 'Never smoker',
print.tau2 = F,
col.diamond = 'blue',
col.diamond.lines = 'black',
col.square = 'black',
col.square.lines = 'black',
digits.sd = 2)
null <- dev.off()
event_rates_former
table_6_word
View(quality_rating)
#Table 6
quality_rating
fair <- nrow(filter(quality_rating, quality_rating$overall_quality == "Fair" ))
poor <- nrow(filter(quality_rating, quality_rating$overall_quality == "Poor" ))
fair
fair <- nrow(filter(quality_rating, quality_rating$overall_quality == "fair" ))
poor <- nrow(filter(quality_rating, quality_rating$overall_quality == "poor" ))
